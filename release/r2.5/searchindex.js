Search.setIndex({"docnames": ["debug", "eager_mode", "gpu", "index", "multi_process_distributed", "notes/source_of_recompilation", "quantized_ops", "runtime", "spmd", "torch_compile"], "filenames": ["debug.rst", "eager_mode.rst", "gpu.rst", "index.rst", "multi_process_distributed.rst", "notes/source_of_recompilation.md", "quantized_ops.rst", "runtime.rst", "spmd.rst", "torch_compile.rst"], "titles": ["Troubleshooting", "Eager Mode + Compile API", "How to run with PyTorch/XLA:GPU", "PyTorch/XLA documentation", "How to do DistributedDataParallel(DDP)", "Source of recompilations in torch_xla", "Quantized Operations for XLA device (Experimental feature)", "PJRT Runtime", "PyTorch/XLA SPMD User Guide", "TorchDynamo(torch.compile) integration in PyTorch XLA"], "terms": {"note": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], "inform": [0, 3, 5, 7], "thi": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], "section": [0, 2, 3, 7, 8], "i": [0, 1, 2, 3, 4, 6, 7, 9], "subject": 0, "remov": [0, 7], "futur": [0, 3, 5, 7, 8], "releas": [0, 2, 3, 4, 6, 7, 8, 9], "softwar": 0, "sinc": [0, 3, 4, 5, 7, 8, 9], "mani": [0, 3, 5, 7], "them": [0, 3, 5, 7], "ar": [0, 1, 4, 5, 6, 7, 8, 9], "peculiar": 0, "given": [0, 3, 4, 5, 8], "intern": [0, 3, 5, 7, 8], "implement": [0, 1, 4, 5, 7, 8, 9], "which": [0, 2, 3, 4, 5, 7, 8, 9], "might": [0, 3, 5], "chang": [0, 3, 4, 5, 6, 8], "befor": [0, 3, 4, 5, 7, 8, 9], "ani": [0, 3, 4, 5, 7, 8], "depth": [0, 7], "we": [0, 1, 2, 3, 4, 5, 7, 8, 9], "want": [0, 1, 3, 5, 7, 8, 9], "do": [0, 2, 3, 5, 6, 7, 8], "instal": [0, 2, 7], "should": [0, 1, 2, 3, 4, 5, 7, 8], "match": [0, 3], "out": [0, 1, 3, 7, 8, 9], "our": [0, 2, 3, 4, 5, 7, 8, 9], "readm": 0, "detial": 0, "avail": [0, 3, 4, 5, 7], "vm": [0, 2, 3, 4, 7], "python": [0, 2, 3, 4, 5, 7, 8, 9], "import": [0, 1, 3, 4, 6, 7, 8, 9], "torch": [0, 1, 2, 3, 4, 5, 6], "torch_xla": [0, 1, 2, 4, 6, 7, 8, 9], "print": [0, 2, 3, 4, 5, 7, 8, 9], "__version__": 0, "2": [0, 1, 2, 3, 4, 6, 7, 9], "1": [0, 1, 2, 3, 4, 7, 8, 9], "0": [0, 2, 3, 4, 5, 7, 8, 9], "cu121": 0, "export": [0, 2, 7], "pjrt_devic": [0, 2, 3, 7], "tpu": [0, 2, 9], "python3": [0, 2, 3, 4, 7], "core": [0, 1, 3, 4, 6, 7, 8, 9], "xla_model": [0, 4, 6, 7, 8, 9], "xm": [0, 1, 3, 4, 6, 8, 9], "t1": [0, 3, 8], "100": [0, 2, 4], "devic": [0, 1, 2, 4, 5, 7, 8, 9], "xla_devic": [0, 3, 4, 6, 7, 8, 9], "t2": [0, 8], "200": 0, "300": [0, 1], "For": [0, 2, 3, 4, 5, 6, 7, 8, 9], "nightli": [0, 4, 8], "git": [0, 2, 4, 7], "clone": [0, 2, 7], "http": [0, 2, 3, 4, 7, 8], "github": [0, 2, 3, 4, 7, 8], "com": [0, 2, 3, 4, 7, 8], "test_train_mp_imagenet": [0, 2, 4, 7], "py": [0, 2, 3, 4, 7, 8], "fake_data": [0, 2, 4, 7], "x": [0, 3, 4, 5, 6, 8], "y": [0, 2, 3, 4, 5, 6, 8], "you": [0, 1, 2, 3, 4, 7, 8, 9], "us": [0, 1, 2, 3, 7, 9], "branch": [0, 5, 7], "rx": 0, "exampl": [0, 1, 3, 5, 6, 7, 9], "r2": [0, 7, 8], "If": [0, 2, 3, 5, 6, 7, 8], "can": [0, 1, 2, 3, 4, 6, 7, 8, 9], "conclud": 0, "correctli": [0, 2, 8], "To": [0, 1, 2, 3, 4, 5, 6, 7, 8], "diagnos": 0, "issu": [0, 1, 3, 4, 7, 8], "counter": [0, 3], "provid": [0, 3, 4, 5, 6, 8, 9], "first": [0, 3, 4, 7, 8], "thing": 0, "when": [0, 1, 3, 4, 7, 8, 9], "model": [0, 1, 4, 5, 7, 8, 9], "slow": 0, "gener": [0, 1, 3, 5, 7], "extrem": 0, "help": [0, 5], "pleas": [0, 2, 3, 4, 6, 7, 8], "try": [0, 5], "includ": [0, 2, 3, 5, 7, 8], "your": [0, 2, 3, 4, 5, 7, 8], "bug": [0, 4, 7], "sent": [0, 3], "u": [0, 2, 5, 7, 9], "have": [0, 2, 3, 4, 5, 7, 8, 9], "enabl": [0, 1, 2, 3, 4, 6, 8], "set": [0, 3, 4, 5, 7, 8, 9], "pt_xla_debug_level": 0, "coupl": [0, 3], "featur": [0, 3, 4, 7, 8], "also": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], "lower": [0, 5], "level": [0, 6, 8, 9], "slip": 0, "analyz": 0, "summari": 0, "some": [0, 1, 3, 4, 6, 7, 8], "output": [0, 3, 4, 7, 9], "would": [0, 3, 5, 7], "pt": [0, 3, 7], "compiletim": 0, "too": [0, 5], "frequent": 0, "21": 0, "count": [0, 3], "dure": [0, 3, 4, 8, 9], "11": [0, 2, 5], "step": [0, 1, 2, 3, 4, 5, 7, 8, 9], "transferfromdevicetim": 0, "op": [0, 1, 3, 5, 8], "": [0, 1, 2, 3, 4, 6, 7, 8, 9], "aten": [0, 5], "_ctc_loss": 0, "_ctc_loss_backward": 0, "open": [0, 7], "abov": [0, 1, 2, 3, 4, 5, 7, 8, 9], "request": [0, 3, 4, 5, 8], "23": [0, 2], "12": [0, 2, 4, 7, 9], "everi": [0, 3, 5, 7, 8, 9], "caus": [0, 1, 3, 5, 7], "mark_step": [0, 1, 3, 4, 7], "parallel": [0, 3, 7], "loader": [0, 3, 9], "end": [0, 2, 3, 4, 7, 8], "graph": [0, 1, 3, 4, 5, 7, 8, 9], "info": [0, 2, 3, 5, 8], "hash": 0, "c74c3b91b855b2b123f833b0d5f86943": 0, "number": [0, 1, 3, 4, 7, 8], "input": [0, 1, 3, 7, 8], "35": [0, 2, 7], "107": 0, "frame": 0, "trigger": [0, 5], "workspac": 0, "dk3": 0, "1055": 0, "next": [0, 3, 5, 6, 8], "distribut": [0, 4], "parallel_load": [0, 3, 7], "44": 0, "__next__": 0, "32": [0, 3], "train_loop_fn": 0, "train_decoder_only_bas": 0, "48": [0, 4], "start_train": 0, "65": [0, 1], "modul": [0, 3, 4, 8], "73": 0, "post": [0, 3], "size": [0, 2, 3, 5, 7, 8], "548000": 0, "gb": 0, "7": [0, 3, 4, 9], "922460": 0, "alias": 0, "547871": 0, "intermedi": [0, 7], "124478": 0, "program": [0, 3, 5, 8, 9], "028210": 0, "user": [0, 1, 2, 3, 5, 6, 7, 9], "manual": [0, 1, 4], "call": [0, 1, 3, 4, 5, 7, 8, 9], "configur": [0, 2, 3, 7, 8], "batch": [0, 3, 7, 8], "exit": [0, 3, 4], "steptrac": 0, "region": [0, 1, 3, 8], "decid": [0, 3, 5], "access": [0, 3, 5, 7, 8], "often": [0, 1, 5], "due": [0, 7], "log": [0, 2], "valu": [0, 3, 5, 7, 8], "4": [0, 2, 3, 4, 5, 6, 7, 8, 9], "expect": [0, 1, 5, 6, 7, 9], "avoid": [0, 2], "5": [0, 2, 3, 4, 5, 6], "either": [0, 2, 3, 5, 7], "reduc": [0, 1, 3, 4, 7], "frequenc": 0, "add": [0, 3, 4, 5, 9], "see": [0, 2, 3, 4, 5, 7, 9], "pair": 0, "after": [0, 2, 3, 5, 7, 8], "stabil": [0, 7], "onli": [0, 1, 2, 3, 5, 7, 8, 9], "disabl": [0, 1, 3], "effici": [0, 9], "same": [0, 1, 3, 5, 6, 7, 8], "code": [0, 1, 3, 4, 5, 7, 8, 9], "happen": [0, 1, 3, 5, 7], "onc": [0, 3, 5, 8, 9], "keep": [0, 5, 7], "dump": [0, 3], "ir": [0, 3, 5], "hlo": [0, 3], "follow": [0, 1, 2, 3, 4, 5, 7, 8], "compar": [0, 1, 3, 4, 7, 9], "each": [0, 3, 4, 5, 7, 8, 9], "sourc": [0, 3], "differ": [0, 3, 4, 5, 8], "explain": [0, 3, 5, 8], "how": [0, 1, 3, 5, 7], "detail": [0, 3, 5, 7], "put": [0, 3, 4], "line": [0, 1, 3, 4, 5], "met": 0, "short": [0, 5], "contain": [0, 2, 3, 5, 7], "few": [0, 3, 4, 5, 8], "kei": [0, 7, 8], "short_metrics_report": [0, 3], "full": [0, 2, 3, 4], "all": [0, 2, 3, 4, 5, 7, 8], "metrics_report": [0, 3], "like": [0, 3, 4, 5, 7, 8], "time": [0, 2, 3, 5, 7, 8, 9], "spent": 0, "handl": [0, 1, 4, 5, 8], "creat": [0, 4, 7, 8], "destroi": 0, "etc": [0, 1, 2, 3, 5, 8], "term": [0, 1, 5], "percentil": 0, "sampl": [0, 3, 7], "an": [0, 4, 5, 7, 8, 9], "totalsampl": 0, "202": 0, "06m09s401ms746": 0, "001u": 0, "valuer": 0, "778ms572": 0, "062u": 0, "second": [0, 4, 7, 8], "rate": [0, 2, 4], "425201": 0, "001ms32": 0, "778u": 0, "001ms61": 0, "283u": 0, "10": [0, 2, 3, 5, 6, 7, 8, 9], "001ms79": 0, "236u": 0, "20": [0, 2, 3, 4, 6], "001ms110": 0, "973u": 0, "50": [0, 2], "001ms228": 0, "773u": 0, "80": [0, 2], "001ms339": 0, "183u": 0, "90": 0, "001ms434": 0, "305u": 0, "95": 0, "002ms921": 0, "063u": 0, "99": [0, 4], "21s102ms853": 0, "173u": 0, "name": [0, 2, 3, 5, 7, 8], "integ": [0, 3], "track": [0, 8], "statu": 0, "cachedsynctensor": 0, "395": [0, 4], "In": [0, 1, 2, 3, 5, 7, 8, 9], "start": [0, 1, 3, 7], "indic": [0, 3, 5], "context": [0, 3, 5, 7], "switch": [0, 3, 4, 5], "between": [0, 2, 3, 4, 5, 7, 8], "cpu": [0, 2, 4, 5, 6, 8], "potenti": [0, 3, 7, 8], "optim": [0, 1, 2, 3, 4, 5, 7, 8, 9], "area": 0, "oper": [0, 3, 7, 8], "rout": 0, "back": [0, 3, 8], "engin": 0, "thei": [0, 3, 5, 7, 8], "fulli": [0, 1, 3, 7], "qualifi": 0, "c": [0, 3, 5, 7], "namespac": 0, "nonzero": [0, 5], "33": [0, 2, 4, 9], "other": [0, 2, 3, 4, 5, 6, 7, 8], "than": [0, 4, 5, 7], "_local_scalar_dens": 0, "usual": [0, 1, 3], "mean": [0, 3, 4, 5, 7, 8], "miss": [0, 3], "feel": [0, 4], "free": [0, 4], "epoch": [0, 2, 4], "clear_al": 0, "xla_dynamo_debug": 0, "workload": [0, 3, 7, 8], "bottleneck": 0, "resourc": [0, 3], "offici": 0, "tutori": [0, 4, 8], "colab": 0, "notebook": 0, "mnist": [0, 2, 3, 7], "train": [0, 2, 3, 8], "script": [0, 3, 7], "util": [0, 2, 3, 4, 6, 8], "captur": [0, 3], "take": [0, 3, 5, 8], "look": [0, 3, 8], "train_resnet_benchmark": 0, "blob": [0, 3, 4, 7, 8], "master": [0, 3, 4, 7, 8], "_": [0, 4, 7, 9], "behav": 0, "semant": [0, 5], "regular": [0, 3, 6], "share": [0, 2, 3, 7, 8], "interfac": [0, 3, 8], "gpu": [0, 3, 8], "howev": [0, 8], "constraint": [0, 7], "hardwar": [0, 3], "lazi": [0, 5, 8, 9], "evalu": [0, 5], "suggest": 0, "certain": [0, 5], "pattern": [0, 5, 9], "result": [0, 3, 4, 7, 8], "bad": 0, "show": [0, 3, 4, 7], "mind": [0, 7], "yield": [0, 3], "degrad": 0, "recompil": [0, 1, 3], "expens": [0, 1, 5], "automat": [0, 3, 4, 5, 7, 8], "new": [0, 1, 3, 5, 8, 9], "shape": [0, 3, 8], "encount": [0, 7], "within": [0, 3, 6, 8], "huge": [0, 4, 5], "speedup": [0, 9], "rest": [0, 5, 7], "order": [0, 2, 3, 8], "must": [0, 3, 7, 8], "constant": [0, 8], "comput": [0, 2, 3, 5, 7, 8], "across": [0, 3, 4, 7, 8], "host": [0, 2, 3, 4, 7, 8], "possibl": [0, 3, 4, 7, 8], "direct": [0, 7], "indirect": 0, "introduc": [0, 1, 4, 7, 8], "dynam": [0, 9], "mask": [0, 5], "index": [0, 3, 7], "base": [0, 1, 2, 3, 4, 5, 7, 8], "where": [0, 3, 4, 5, 7, 8], "loop": [0, 1, 3, 5, 8], "iter": [0, 3, 8, 9], "thu": [0, 2, 7], "requir": [0, 2, 3, 5, 7, 8], "solut": [0, 5, 6], "low": 0, "variat": 0, "pad": [0, 5], "fix": [0, 8, 9], "don": [0, 1, 3, 4, 5, 7], "t": [0, 1, 3, 4, 5, 7, 8], "nativ": [0, 1, 2, 4, 7, 8], "translat": 0, "transfer": [0, 3, 7, 8], "memori": [0, 2, 4, 5], "lead": 0, "signific": [0, 9], "slowdown": [0, 4], "item": 0, "explicitli": [0, 3, 5], "ask": [0, 1, 5], "unless": [0, 5], "necessari": [0, 3], "most": [0, 3, 7, 9], "checkout": [0, 2], "find": [0, 4, 7, 8], "even": [0, 3, 4, 5, 7], "scalar": [0, 5], "substitut": 0, "control": [0, 3, 8], "flow": 0, "applic": [0, 6, 8], "e": [0, 3, 4, 5, 6, 7, 8], "g": [0, 2, 3, 5, 6, 7, 8], "clip_grad": 0, "norm": 0, "problemat": 0, "impact": [0, 3, 4, 5, 7], "so": [0, 2, 3, 4, 5, 7, 8], "patch": 0, "clip_grad_norm_": 0, "instead": [0, 1, 3, 4, 5, 7, 8, 9], "give": [0, 6, 8], "dramat": 0, "improv": [0, 3, 7, 8, 9], "block": [0, 3, 4, 8], "els": [0, 5], "paramet": [0, 3, 7, 8], "total_norm": 0, "zero": [0, 4, 8], "none": [0, 3, 8], "p": [0, 2, 5, 7], "param_norm": 0, "grad": 0, "norm_typ": 0, "add_": 0, "clip_coef": 0, "max_norm": 0, "1e": [0, 9], "6": [0, 2, 3, 5], "mul_": 0, "data_parallel": 0, "mai": [0, 3, 5, 7, 8], "drop": 0, "last": 0, "make": [0, 1, 2, 3, 4, 5, 7, 8, 9], "sure": [0, 2, 3], "amount": [0, 3, 5], "work": [0, 3, 4, 5, 6, 7, 8, 9], "dataset": [0, 4], "small": [0, 1, 4, 5, 9], "therefor": 0, "better": [0, 1, 3, 5, 7, 9], "those": [0, 3, 4], "case": [0, 3, 7, 8, 9], "opaqu": [0, 3], "alwai": [0, 3, 5, 7, 8], "appear": [0, 3], "contigu": [0, 3], "without": [0, 3, 7, 8], "storag": [0, 2, 3, 4, 8], "network": [0, 3, 7, 8], "stride": 0, "move": [0, 4, 5, 7, 8], "save": [0, 4, 8], "directli": [0, 3, 4, 5, 7, 8], "load": [0, 4, 6, 7, 8], "were": [0, 3, 5], "from": [0, 4, 8, 9], "unavail": [0, 3], "fail": [0, 3, 8], "let": [0, 3, 7, 8, 9], "machin": [0, 2, 7], "care": [0, 3, 5], "taken": [0, 3, 4, 5, 8], "type": [0, 2, 3, 4, 6, 7], "doe": [0, 3, 5, 7, 8], "preserv": [0, 3], "view": [0, 3], "relationship": [0, 3], "reconstruct": 0, "copi": [0, 3, 7], "return": [0, 1, 3, 4, 5, 6, 8, 9], "deep": 0, "shallow": 0, "weight": [0, 3, 6, 8], "one": [0, 3, 4, 5, 7, 8, 9], "anoth": [0, 3, 5], "ty": 0, "done": [0, 3, 5], "otherwis": [0, 3, 5, 8], "two": [0, 3, 5, 7, 8], "independ": [0, 3, 7], "made": [0, 5, 8], "But": [0, 3, 5], "submit": 0, "addit": [0, 2, 3, 4, 7], "doesn": [0, 3, 5, 8], "_xlac": [0, 5], "_get_xla_tensors_text": [0, 5], "re": [0, 1, 3, 5, 7, 8], "_get_xla_tensors_hlo": 0, "function": [0, 1, 3, 6, 8, 9], "prior": [0, 8], "alreadi": [0, 2, 3, 4, 5, 8], "materi": [0, 3, 5, 8], "There": [0, 1, 3, 4, 5, 8, 9], "behavior": [0, 3, 7], "stack": [0, 3, 5, 8], "degre": 0, "xla_ir_debug": 0, "trace": [0, 1, 3, 4, 5, 7, 8, 9], "node": [0, 5], "henc": [0, 9], "allow": [0, 3, 8], "wa": [0, 3, 5, 7, 8], "respons": [0, 8, 9], "xla_hlo_debug": [0, 3], "_xla_ir": 0, "activ": [0, 3, 4, 6], "propag": 0, "metadata": 0, "xla_save_tensors_fil": 0, "path": [0, 2, 3, 4, 5], "file": [0, 2, 3, 4, 7], "becom": [0, 5, 7], "realli": [0, 5, 9], "big": [0, 5], "option": [0, 3, 6, 7, 8], "left": 0, "long": [0, 1, 4, 5], "append": 0, "clean": [0, 9], "sheet": 0, "xla_save_tensors_fmt": 0, "format": [0, 3, 6, 9], "store": [0, 3], "_xla_save_tensor": 0, "text": 0, "default": [0, 1, 2, 3, 4, 7, 8], "dot": 0, "graphviz": 0, "xla_flag": 0, "xla_dump_to": 0, "tmp": [0, 3, 4], "dir_nam": 0, "unoptim": 0, "optimz": 0, "per": [0, 2, 3, 4, 6, 7, 9], "xla_metrics_fil": 0, "local": [0, 2, 3, 7, 8], "exist": [0, 1, 3, 7, 8, 9], "xla_save_hlo_fil": 0, "error": [0, 3], "offend": 0, "xla_sync_wait": 0, "forc": [0, 3, 5, 7], "sync": [0, 1, 2, 3], "wait": [0, 3], "its": [0, 3, 4, 7, 8, 9], "complet": [0, 3], "xla_use_eager_debug_mod": 0, "eagerli": [0, 1, 3, 5], "bypass": 0, "overal": 0, "lot": [0, 3, 5], "slower": [0, 4], "usag": [0, 2, 3, 4, 5, 8], "higher": [0, 8], "optimizaiton": 0, "skip": [0, 9], "tf_cpp_log_thread_id": 0, "tf": [0, 5], "thread": [0, 3, 7, 8], "id": [0, 2, 3, 7], "multithread": [0, 3], "process": [0, 1, 2, 4, 6, 7, 8], "tf_cpp_vmodul": 0, "vlog": 0, "form": [0, 5, 7], "tf_cpp_min_log_level": 0, "messag": [0, 3], "turn": 0, "warn": 0, "tf_vlog": 0, "tensorflow": [0, 3, 5, 7], "xla_dump_hlo_graph": 0, "part": [0, 1, 3, 7, 8], "runtim": [0, 2, 4, 8], "rais": [0, 3], "xla_util": 0, "cc": 0, "record": [0, 3], "save1": 0, "xla_graph_executor": 0, "pjrt_computation_cli": 0, "3": [0, 1, 2, 3, 4, 6, 8, 9], "pr": [0, 4], "repo": [0, 3], "dir": 0, "pytorch_test_with_slow": 0, "test_torch": 0, "k": 0, "test_put_xla_uint8": 0, "command": [0, 2, 3, 4, 7], "need": [0, 2, 3, 4, 5, 7, 8], "torch_test_devic": 0, "pytorch_test_bas": 0, "doc": [1, 2, 5, 7, 8], "go": [1, 2, 3, 8], "over": [1, 2, 3, 4, 7, 8], "pytorch": [1, 5, 6, 7], "xla": [1, 5, 7], "experiment": [1, 4, 7, 8, 9], "The": [1, 2, 3, 4, 5, 6, 7, 8, 9], "goal": 1, "experi": [1, 4, 7, 8], "more": [1, 2, 3, 5, 7, 8], "align": 1, "develop": [1, 3, 4, 6, 8, 9], "easier": [1, 5], "current": [1, 2, 3, 4, 5, 6, 7, 8, 9], "run": [1, 4, 5, 6, 7, 9], "lazytensor": [1, 3], "torchvis": [1, 9], "resnet18": [1, 9], "randn": [1, 3, 4, 6, 7, 8, 9], "64": [1, 4, 9], "224": 1, "execut": [1, 2, 3, 4, 5, 7, 8, 9], "actual": [1, 4, 5, 8], "multipl": [1, 5, 6, 9], "drawback": 1, "approach": [1, 4, 5], "confus": 1, "about": [1, 3, 5, 7], "framework": [1, 3, 5, 6], "non": [1, 3, 5, 8], "data": [1, 2, 3, 5, 7, 9], "preprocess": [1, 6], "pend": [1, 3], "get": [1, 2, 3, 4, 5, 6, 7], "leak": 1, "main": [1, 7, 8], "whole": [1, 3, 5, 9], "veri": [1, 2, 3, 5], "It": [1, 2, 3, 4, 5, 6, 8, 9], "hard": [1, 4, 5, 9], "debug": [1, 5, 6], "why": [1, 5], "mitig": 1, "ux": 1, "eager_mod": [1, 3], "true": [1, 3, 4, 5, 7, 8], "mark": [1, 3], "compiled_model": 1, "right": [1, 5, 9], "awai": 1, "ha": [1, 3, 5, 7, 8], "wrap": [1, 3, 4, 6, 8], "pretti": [1, 3, 4, 5], "straight": 1, "forward": [1, 4, 6, 8, 9], "enter": 1, "target": [1, 3, 5, 7, 9], "reenabl": 1, "perfomr": 1, "backend": [1, 3, 5, 6, 7, 8, 9], "openxla": [1, 6, 9], "recommen": 1, "overhad": 1, "def": [1, 3, 4, 6, 7, 8, 9], "step_fn": 1, "loss_fn": [1, 3, 4, 7, 9], "zero_grad": [1, 3, 4, 7], "logit": [1, 8], "loss": [1, 2, 3, 4, 7, 8, 9], "backward": [1, 3, 4, 7, 8, 9], "refactor": 1, "becaus": [1, 3, 7, 8], "togeth": [1, 3, 4, 7, 8], "now": [1, 3, 5, 7, 8], "recommend": [1, 2, 3, 7, 8], "reason": [1, 4, 7], "layer": [1, 4, 8], "decod": 1, "much": [1, 3, 5, 7, 9], "just": [1, 3, 4, 5, 7, 8], "llama2": 1, "fake": [1, 8], "singl": [1, 4, 5, 8, 9], "chip": [1, 7], "v4": [1, 3, 7, 8, 9], "8": [1, 2, 3, 5, 6, 7, 8, 9], "below": [1, 2, 5, 7, 8], "observ": [1, 4, 7], "token": [1, 6], "147": 1, "achiev": [1, 4], "45": [1, 2], "perform": [1, 3, 4, 6, 8, 9], "trainer": 1, "test": [1, 2, 4, 7], "found": [1, 2, 7], "here": [1, 2, 3, 4, 5, 8, 9], "perfomran": 1, "depend": [1, 3, 5], "tri": 1, "resnet50": [1, 3, 7, 9], "exepct": 1, "meant": 1, "logic": [1, 3, 5, 8], "random": [1, 3, 6, 7], "compil": [2, 5, 6, 7], "acceler": [2, 3, 7], "basic": [2, 4, 5], "nvidia": 2, "attach": [2, 8], "cloud": [2, 3, 7, 8, 9], "googl": [2, 3, 7], "cuda": [2, 3, 5, 6, 7], "driver": 2, "publish": 2, "prebuilt": 2, "imag": [2, 4, 5, 7], "cuda11": 2, "correspond": [2, 3, 4, 8], "config": 2, "list": [2, 3, 8], "refer": [2, 3, 4, 6, 7, 8], "sudo": [2, 7], "pull": [2, 4], "central1": 2, "pkg": 2, "dev": [2, 4], "nightly_3": 2, "8_cuda_12": 2, "toolkit": 2, "datacent": 2, "latest": 2, "guid": [2, 3, 4, 7], "html": [2, 4, 7], "curl": 2, "fssl": 2, "io": [2, 4, 7], "libnvidia": 2, "gpgkei": 2, "gpg": 2, "dearmor": 2, "o": [2, 4, 7], "usr": 2, "keyr": 2, "l": 2, "stabl": [2, 4, 7], "deb": 2, "sed": 2, "sign": 2, "tee": 2, "apt": 2, "d": [2, 3, 5], "updat": [2, 3, 5, 8], "ctk": 2, "systemctl": 2, "restart": [2, 7], "shm": 2, "16g": 2, "net": [2, 7], "bin": 2, "bash": [2, 4], "exec": 2, "awk": 2, "nr": 2, "visibl": [2, 3, 5], "smi": 2, "verifi": 2, "root": [2, 3, 5], "20ab2c7a2d06": 2, "dec": 2, "06": 2, "24": 2, "29": [2, 4, 9], "2022": 2, "510": 2, "47": 2, "03": 2, "version": [2, 7, 8], "persist": [2, 3, 8], "m": [2, 4, 5], "bu": 2, "disp": 2, "A": [2, 3, 5, 6, 7, 8], "volatil": 2, "uncorr": 2, "ecc": 2, "fan": 2, "temp": 2, "perf": [2, 5], "pwr": 2, "cap": 2, "mig": 2, "tesla": 2, "v100": 2, "sxm2": 2, "off": 2, "00000000": 2, "00": [2, 4], "04": [2, 9], "n": [2, 3, 6], "36c": 2, "p0": 2, "38w": 2, "300w": 2, "0mib": 2, "16384mib": 2, "gi": 2, "ci": 2, "pid": 2, "No": [2, 5, 6, 7], "ld_library_path": 2, "account": 2, "echo": 2, "link": 2, "bashrc": 2, "lib64": 2, "compat": [2, 6, 7, 8], "x86_64": 2, "linux": 2, "architecutr": 2, "architectur": [2, 4, 7], "system": [2, 8], "unam": 2, "pip3": 2, "whl": 2, "googleapi": 2, "cp310": 2, "manylinux_2_28_x86_64": 2, "repositori": [2, 7], "imagenet": 2, "what": [2, 3], "gpu_num_devic": [2, 7], "recurs": [2, 4, 8], "prepar": 2, "begin": [2, 8], "38": 2, "89059": 2, "82": 2, "globalr": 2, "13": [2, 3, 4, 7], "79297": 2, "117": 2, "16": [2, 3, 4, 6, 8], "84": 2, "36": 2, "40": [2, 4], "43628": 2, "281": 2, "49": [2, 9], "43": [2, 9], "60": [2, 4], "83108": 2, "346": 2, "88": [2, 8], "108": 2, "99023": 2, "373": 2, "62": [2, 9], "132": 2, "56": 2, "92699": 2, "384": 2, "152": 2, "14": 2, "02": [2, 4], "120": 2, "68816": 2, "388": 2, "169": 2, "09": 2, "train_resnet_bas": 2, "35pm": 2, "utc": 2, "jun": 2, "08": 2, "2024": 2, "887794017791748": 2, "746502586051985": 2, "877807140350342": 2, "238": 2, "4789458412044": 2, "867819786071777": 2, "329": 2, "86095958663503": 2, "30": [2, 4, 7], "857839584350586": 2, "367": 2, "3038003653586": 2, "847847938537598": 2, "381": 2, "53141087190835": 2, "837860584259033": 2, "387": 2, "80462249591113": 2, "260": 2, "628140926361084": 2, "391": 2, "135639565343": 2, "270": 2, "618192195892334": 2, "6901797745233": 2, "280": 2, "608224391937256": 2, "1602680460045": 2, "290": 2, "598264217376709": 2, "6731498290759": 2, "36pm": 2, "reus": [2, 3], "rule": 2, "modifi": [2, 8, 9], "insid": [2, 3, 8], "cd": [2, 4], "use_cuda": 2, "bdist_wheel": 2, "hermet": 2, "xla_cuda": 2, "been": [2, 3, 5, 7, 8], "successfulli": 2, "packag": [3, 4], "learn": [3, 7], "connect": [3, 7, 8], "troubleshoot": 3, "eager": [3, 4, 5, 6], "mode": [3, 4, 5, 6], "distributeddataparallel": [3, 7], "ddp": [3, 7], "quantiz": 3, "pjrt": [3, 8], "shard": 3, "fsdp": 3, "via": [3, 4, 7], "advanc": 3, "topic": 3, "checkpoint": [3, 4, 7], "torchdynamo": 3, "integr": [3, 6], "describ": [3, 4, 8], "familiar": [3, 8], "initi": [3, 4, 7, 8], "environ": [3, 4, 7, 8], "ad": [3, 5, 6, 8, 9], "t0": 3, "Or": [3, 5, 7], "matrix": 3, "multipli": [3, 8], "mm": 3, "neural": 3, "l_in": 3, "linear": [3, 4, 6, 7], "nn": [3, 4, 6, 7, 8, 9], "l_out": 3, "floattensor": 3, "throw": 3, "build": [3, 4], "convert": [3, 4], "specif": [3, 4, 6], "snippet": [3, 8], "highlight": 3, "nllloss": 3, "sgd": [3, 4, 7, 9], "lr": [3, 4, 7, 8, 9], "momentum": 3, "train_load": [3, 8], "easi": [3, 5, 7], "definit": [3, 5], "dataload": [3, 4, 8], "acquir": 3, "pl": [3, 7, 8], "_mp_fn": [3, 7], "mp_device_load": 3, "mpdeviceload": [3, 8], "optimizer_step": [3, 4], "__name__": [3, 4, 7], "__main__": [3, 4, 7], "launch": [3, 4, 7, 9], "arg": [3, 4], "three": 3, "previou": [3, 5, 7], "wrapper": [3, 4, 8], "spawn": [3, 7], "torchrun": [3, 7], "abl": [3, 5, 8], "assign": 3, "being": [3, 4, 8], "up": [3, 5, 7, 8], "own": [3, 4], "v2": 3, "v3": 3, "check": [3, 6, 8], "onto": 3, "preload": 3, "overlap": [3, 8, 9], "batches_per_execut": 3, "consolid": [3, 4], "gradient": [3, 4], "all_reduce_gradi": 3, "remain": [3, 5], "retriev": [3, 5, 8, 9], "parent": 3, "multiprocess": [3, 7], "setup": [3, 4], "talk": 3, "bit": [3, 6], "basi": 3, "gcloud": [3, 7], "project": [3, 7], "howto": 3, "focu": [3, 5], "perspect": [3, 7], "assum": [3, 4, 5, 8], "train_mnist_xla": 3, "ssh": [3, 7], "tpuvm": [3, 7, 8], "scp": [3, 7], "alpha": [3, 7], "zone": [3, 7], "worker": [3, 4, 7, 8], "outsid": 3, "underli": 3, "infrastructur": 3, "awar": 3, "global": [3, 7, 8], "topologi": [3, 8], "ordin": 3, "cross": [3, 8], "commun": [3, 7, 8, 9], "regard": [3, 9], "fakedata": 3, "though": [3, 4], "act": 3, "uniqu": [3, 5], "immedi": [3, 8], "hand": 3, "until": [3, 8], "defer": 3, "separ": [3, 4, 8, 9], "fuse": 3, "invis": 3, "caller": 3, "construct": [3, 4, 8], "send": [3, 7, 8], "synchron": [3, 7, 8], "insert": 3, "barrier": [3, 7], "design": [3, 7, 8, 9], "paper": 3, "represent": [3, 8], "expos": [3, 7, 8], "unlik": 3, "adjust": 3, "wai": [3, 4, 5, 6, 7, 8, 9], "again": 3, "appreci": 3, "accommod": 3, "transit": 3, "recreat": 3, "destin": 3, "previous": 3, "state_dict": [3, 4, 8], "limit": [3, 7], "footprint": 3, "serial": [3, 7], "xser": 3, "stream": 3, "restor": [3, 8], "load_state_dict": [3, 8], "under": [3, 4, 7], "consum": [3, 5], "disk": 3, "significantli": [3, 7], "still": [3, 4, 5, 7, 8], "occur": 3, "opt": 3, "through": [3, 5, 8], "initialize_cach": 3, "xr": [3, 4, 7, 8], "your_cache_path": 3, "readonli": 3, "fals": [3, 4, 8], "specifi": [3, 4, 8], "whether": 3, "write": [3, 8], "mount": 3, "xmp": [3, 7], "init": [3, 4, 7, 9], "mp_fn": 3, "f": [3, 4, 6, 8], "xla_cache_": 3, "global_ordin": [3, 4, 7], "runnabl": [3, 4, 8], "int": [3, 5, 7, 8], "instanc": [3, 4, 8], "virtual": [3, 8], "device_count": [3, 8], "address": [3, 7, 8], "bool": 3, "finish": 3, "callabl": [3, 4], "full_graph": 3, "str": 3, "num_different_graphs_allow": 3, "repres": [3, 5, 7], "funciton": 3, "pass": [3, 4, 7, 8], "manag": [3, 8], "pt_xla_debug": 3, "well": [3, 5, 7, 8], "exceed": 3, "foo": 3, "sin": 3, "co": 3, "foo2": 3, "compiled_foo2": 3, "manual_se": [3, 7], "seed": 3, "state": [3, 4, 8], "rng": [3, 7], "device_typ": 3, "select": [3, 7, 8], "string": [3, 8], "local_process_count": 3, "local_device_count": 3, "total": [3, 5, 8], "addressable_device_count": 3, "global_device_count": 3, "global_runtime_device_count": [3, 8], "especi": [3, 7, 8, 9], "world_siz": [3, 4, 7, 8], "particip": [3, 7], "job": [3, 9], "rang": [3, 7, 8], "guarante": 3, "predict": 3, "nor": 3, "local_ordin": 3, "get_master_ip": 3, "ip": [3, 7, 8], "discoveri": 3, "use_spmd": [3, 8], "auto": [3, 4], "replic": [3, 8], "spmd_advanc": 3, "md": [3, 7], "is_spmd": 3, "devkind": 3, "custom": [3, 4, 5, 6, 8], "deprec": 3, "xla_device_hw": 3, "union": 3, "map": 3, "real": [3, 9], "is_master_ordin": 3, "while": [3, 4, 5], "num_host": 3, "boolean": 3, "all_reduc": 3, "reduce_typ": 3, "scale": [3, 7, 8, 9], "float": [3, 5], "group": [3, 4, 7, 8], "pin_layout": 3, "inplac": [3, 8], "One": [3, 4], "reduce_sum": 3, "reduce_mul": 3, "reduce_and": 3, "reduce_or": 3, "reduce_min": 3, "reduce_max": 3, "appli": [3, 4, 8], "replica": [3, 7], "defin": [3, 8], "pin": 3, "pine": 3, "prevent": [3, 8, 9], "corrupt": 3, "slightli": 3, "unpin": 3, "hlomodul": 3, "mix": [3, 8], "constrain": [3, 7], "hold": [3, 8], "tupl": [3, 5, 8], "itself": [3, 4], "all_gath": [3, 7], "dim": 3, "gather": [3, 8], "along": [3, 4], "dimens": [3, 8], "all_to_al": 3, "split_dimens": 3, "concat_dimens": 3, "split_count": 3, "alltoal": 3, "www": 3, "org": [3, 4, 7], "operation_semant": 3, "upon": 3, "split": 3, "concat": 3, "add_step_closur": 3, "closur": 3, "run_async": 3, "ones": [3, 5], "report": 3, "consol": 3, "tensorboard": 3, "content": 3, "intermediari": 3, "inspect": 3, "point": [3, 5], "typic": 3, "ensur": [3, 5, 8], "live": [3, 5], "argument": [3, 4, 9], "queu": 3, "sequenti": 3, "advis": 3, "throttl": 3, "event": 3, "asynchron": [3, 8], "wait_device_op": 3, "async": [3, 9], "whose": 3, "empti": 3, "optimizer_arg": 3, "dict": [3, 4], "gradid": 3, "parallelload": [3, 8], "dataparallel": 3, "support": [3, 4, 5, 7, 8, 9], "dictionari": 3, "self": [3, 4, 6, 8], "file_or_path": 3, "textio": 3, "master_onli": [3, 4], "global_mast": 3, "nest": [3, 4], "combin": [3, 5], "object": [3, 8], "overrid": 3, "locat": 3, "flag": 3, "obj_to_sav": 3, "path_to_sav": 3, "rendezv": 3, "tag": [3, 7], "payload": [3, 7], "byte": 3, "b": [3, 5, 7, 8, 9], "mesh": [3, 7], "client": [3, 7], "reach": 3, "xrt": 3, "server": [3, 7], "effect": 3, "alia": 3, "xla_rendezv": 3, "join": 3, "exchang": 3, "posit": 3, "mesh_reduc": 3, "reduce_fn": 3, "toxlatensorarena": 3, "reduct": 3, "receiv": 3, "come": [3, 5], "numpi": [3, 8], "np": [3, 8], "accuraci": [3, 4], "test_accuraci": 3, "set_rng_stat": 3, "get_rng_stat": 3, "get_memory_info": 3, "memoryinfo": 3, "bytes_us": 3, "290816": 3, "bytes_limit": 3, "34088157184": 3, "get_stablehlo": 3, "stablehlo": 3, "infer": [3, 7, 8], "straightforward": 3, "identifi": [3, 8], "env": [3, 7, 8], "var": [3, 8], "get_stablehlo_bytecod": 3, "bytecod": [3, 9], "class": [3, 4, 6, 8], "kwarg": [3, 4, 8], "background": [3, 8], "upload": [3, 8], "per_device_load": [3, 8], "constructor": 3, "train_device_load": 3, "xla_multiprocess": 3, "fn": 3, "nproc": [3, 7], "daemon": 3, "start_method": 3, "At": 3, "moment": 3, "maximum": [3, 6], "creation": 3, "method": [3, 7, 8], "mark_shard": [3, 8], "xlashardedtensor": 3, "partition_spec": [3, 8], "annot": [3, 8], "partit": 3, "spec": 3, "xlatensor": [3, 8], "spmdpartition": [3, 8], "device_mesh": [3, 8], "axi": [3, 8], "rank": [3, 4, 7, 8], "mesh_shap": [3, 8], "ax": [3, 8], "dynamo_custom_op": 3, "dynamo": [3, 6, 9], "variant": [3, 5], "recogniz": 3, "traceabl": 3, "num_devic": [3, 8], "device_id": [3, 8], "arrai": [3, 8], "clear_shard": 3, "clear": 3, "cast": 3, "place": [3, 8], "get_1d_mesh": 3, "set_global_mesh": 3, "get_global_mesh": 3, "axis_nam": [3, 8], "helper": 3, "ndarrai": 3, "ravel": 3, "reshap": 3, "fill": 3, "element": [3, 5, 8], "sequenc": 3, "Its": 3, "length": [3, 5], "len": 3, "get_xla_supported_devic": 3, "get_logical_mesh": 3, "ordereddict": [3, 8], "hybridmesh": [3, 8], "ici_mesh_shap": [3, 8], "dcn_mesh_shap": [3, 8], "hybrid": 3, "ici": 3, "dcn": [3, 8], "increas": 3, "intens": 3, "mdl": 3, "inner": [3, 4, 8], "outer": [3, 4, 8], "slice": [3, 8], "metric": [3, 4], "counter_nam": 3, "metric_nam": 3, "counter_valu": 3, "metric_data": 3, "total_sampl": 3, "accumul": 3, "retain": 3, "circular": 3, "buffer": 3, "sum": [3, 4, 8], "document": [4, 6, 7], "further": 4, "against": 4, "minimum": [4, 8], "abil": [4, 5], "api": [4, 5, 6, 7, 8, 9], "And": [4, 5, 8], "who": 4, "know": [4, 5], "xla_backend": [4, 7, 8], "similar": [4, 6, 7], "nccl": 4, "gloo": [4, 7, 8], "dist": [4, 7, 8], "init_process_group": [4, 7, 8], "new_rank": 4, "gradient_as_bucket_view": [4, 7], "ddp_model": 4, "final": [4, 8], "launcher": 4, "demo_fn": 4, "everyth": [4, 5], "touch": [4, 8], "plu": 4, "five": 4, "sy": 4, "tempfil": 4, "master_addr": [4, 7], "localhost": [4, 7], "master_port": [4, 7], "12355": [4, 7], "cleanup": 4, "destroy_process_group": 4, "toymodel": 4, "__init__": [4, 6], "super": [4, 9], "net1": 4, "1000000": 4, "relu": 4, "net2": 4, "demo_bas": 4, "assert": 4, "graident_as_bucket_view": 4, "mseloss": [4, 7], "001": [4, 7], "label": 4, "run_demo": 4, "collect": [4, 7, 8, 9], "num_epoch": [4, 7], "tot": 4, "statist": 4, "produc": [4, 5], "unit": 4, "median": 4, "90th": 4, "std": 4, "cv": 4, "418": 4, "54": 4, "419": 4, "22": 4, "430": 4, "9": [4, 5], "76": 4, "97": 4, "407": 4, "39": 4, "seem": 4, "extra": [4, 8], "overhead": [4, 7, 9], "test_train_mp_mnist": [4, 7], "17864": 4, "19": [4, 9], "20108": 4, "96": 4, "24351": 4, "74": 4, "5866": 4, "83": 4, "10701": 4, "11770": 4, "14313": 4, "78": 4, "3102": 4, "92": 4, "41": [4, 9], "round": 4, "heavili": [4, 9], "sens": 4, "amort": 4, "logdir": 4, "converg": 4, "high": [4, 6], "caution": 4, "interest": 4, "known": 4, "investig": 4, "enforc": [4, 5], "crash": 4, "xlafullyshardeddataparallel": 4, "my_modul": [4, 8], "adam": [4, 8], "0001": [4, 8], "individu": [4, 8], "leftov": [4, 8], "both": [4, 5, 6, 7, 8, 9], "arxiv": 4, "ab": 4, "1910": 4, "02054": 4, "reshard_after_forward": 4, "test_train_mp_mnist_fsdp_with_ckpt": 4, "test_train_mp_imagenet_fsdp": 4, "larg": [4, 5, 7, 8], "cannot": [4, 5], "fit": 4, "interleav": 4, "submodul": 4, "fsdpvitmodel": 4, "ronghanghu": 4, "vit_10b_fsdp_exampl": 4, "run_vit_train": 4, "simpl": [4, 7, 8], "checkpoint_modul": [4, 8], "3524": 4, "auto_wrap_polici": [4, 8], "size_based_auto_wrap_polici": 4, "polici": [4, 8], "larger": [4, 9], "100m": 4, "transformer_auto_wrap_polici": [4, 8], "transform": [4, 8], "conv2d": 4, "partial": [4, 5, 8], "transformer_layer_cl": [4, 8], "addition": 4, "auto_wrapper_cal": 4, "remateri": 4, "lambda": 4, "latter": 4, "resum": 4, "get_shard_metadata": 4, "consolidate_sharded_model_checkpoint": 4, "stitch": 4, "ckpt": 4, "shard_metadata": 4, "ckpt_path": 4, "pth": 4, "tool": 4, "consolidate_sharded_ckpt": 4, "ckpt_prefix": 4, "your_sharded_checkpoint_fil": 4, "ckpt_suffix": 4, "_rank": 4, "inspir": 4, "mostli": [4, 7], "structur": [4, 8], "fairscal": 4, "fullyshardeddataparallel": 4, "readthedoc": 4, "en": 4, "biggest": [4, 9], "explicit": 4, "resort": 4, "train_resnet_fsdp_auto_wrap": 4, "newer": 4, "wheel": 4, "around": [4, 5, 7], "98": 4, "batch_siz": [4, 7], "drop_last": 4, "use_nested_fsdp": 4, "use_gradient_checkpoint": 4, "final_ckpt": 4, "75": 4, "download": 4, "1k": 4, "datadir": 4, "test_set_batch_s": 4, "eval_interv": 4, "128": [4, 6, 7], "num_warmup_epoch": 4, "lr_scheduler_divide_every_n_epoch": 4, "lr_scheduler_divisor": 4, "residu": 4, "entir": [4, 7], "algorithm": [4, 8], "vision": 4, "vit": 4, "static": 5, "word": 5, "hurt": 5, "understand": 5, "normal": [5, 7, 8], "pov": 5, "sai": 5, "assur": 5, "magic": 5, "gone": 5, "good": [5, 8], "coverag": 5, "aim": [5, 8], "explan": 5, "common": [5, 6, 7, 8], "rid": 5, "mainli": 5, "problem": 5, "beginn": 5, "propos": 5, "reli": 5, "impract": 5, "assumpt": 5, "ye": [5, 6], "sentenc": 5, "vari": [5, 7, 8], "ll": 5, "bucket": [5, 8], "kinda": 5, "anti": 5, "frontend": 5, "matter": 5, "workaround": 5, "okai": 5, "teach": 5, "practic": [5, 7, 8], "enough": 5, "theoret": 5, "max": [5, 8], "trade": 5, "less": [5, 7, 9], "faster": [5, 7, 9], "speed": [5, 9], "sort": 5, "obviou": 5, "shown": [5, 7], "s64": 5, "num_output": 5, "mul": 5, "although": [5, 7], "inde": 5, "_get_xla_tensor_dimension_s": 5, "commonli": 5, "dtype": [5, 6, 7], "cut": 5, "correct": 5, "wrong": 5, "wors": 5, "probabl": 5, "upper": 5, "nit": 5, "simplic": 5, "rand": 5, "solv": 5, "world": [5, 7, 8, 9], "kept": 5, "earli": 5, "accessor": 5, "2d": [5, 8], "implicitli": 5, "doubl": 5, "overload": 5, "easili": [5, 9], "explod": 5, "convers": 5, "cheap": 5, "ve": 5, "hoc": 5, "think": 5, "verison": 5, "bla": 5, "blabla": 5, "interpret": 5, "proce": 5, "choic": 5, "wide": 5, "adopt": 5, "uglier": 5, "win": 5, "pars": 5, "statement": 5, "torchscript": 5, "somehow": 5, "merg": 5, "lazili": [5, 8], "properli": 5, "haven": 5, "thought": 5, "trivial": 5, "effort": [5, 8], "side": 5, "That": 5, "hit": 5, "bandwidth": 5, "automag": 5, "gold": 5, "smart": 5, "trick": 5, "tbh": 5, "longer": 5, "sometim": 5, "unawar": 5, "hope": 5, "smash": 5, "ideal": [5, 9], "blocker": 5, "ahead": 5, "nnc": 5, "symbol": 5, "By": [5, 7], "concret": 5, "kernel": [5, 6], "exactli": 5, "transpos": 5, "With": [5, 7, 9], "brian": 5, "hirsh": 5, "bdhirsh": 5, "question": 5, "comment": 5, "worth": 5, "stick": 5, "torch_warn": 5, "yea": 5, "tell": 5, "hei": 5, "won": 5, "blaze": 5, "fast": 5, "isn": [5, 8], "rewrit": [5, 8], "devirtu": 5, "v": [5, 7], "sound": 5, "great": 5, "carri": [5, 8], "truth": 5, "As": [5, 8], "irvalu": 5, "discrep": 5, "followup": 5, "mention": [5, 9], "1000": 5, "my": [5, 8], "properti": 5, "presenc": 5, "get_dimention_s": 5, "didn": 5, "altern": [5, 6, 7], "condit": 5, "middl": [5, 7], "exponenti": 5, "blowup": 5, "smaller": 5, "fewer": 5, "opportun": 5, "recogn": [5, 9], "could": [5, 7, 8], "break": 5, "feasibl": 5, "annoi": 5, "z": 5, "subgraph": 5, "variabl": [5, 7], "wasn": 5, "materiz": 5, "involv": [5, 8], "combo": 5, "outlin": 6, "offer": [6, 8], "abstract": [6, 8], "blockwis": 6, "int4": 6, "These": [6, 7, 8], "analog": 6, "ecosystem": 6, "benefit": [6, 8], "classifi": 6, "flexibl": 6, "choos": [6, 8], "best": [6, 9], "tensor": [6, 7, 8, 9], "docstr": 6, "layout": 6, "xla_quantized_matmul": 6, "n_input_featur": 6, "n_output_featur": 6, "bfloat16": 6, "w_int": 6, "randint": 6, "127": 6, "int8": 6, "scaler": 6, "purpos": 6, "matmul_output": 6, "quantized_matmul": 6, "x_xla": 6, "w_int_xla": 6, "scaler_xla": 6, "matmul_output_xla": 6, "w": 6, "f_dynamo": 6, "dynamo_out_xla": 6, "myqlinearforxlabackend": 6, "load_weight": 6, "processed_w": 6, "processed_scal": 6, "stuff": 6, "orig_model": 6, "mymodel": 6, "q_weight": 6, "q_weights_for_xla": 6, "process_for_xla": 6, "q_linear": 6, "xlaquantizedlinear": 6, "in_featur": 6, "out_featur": 6, "load_quantized_weight": 6, "channel": 6, "sym": 6, "asym": 6, "w8a16": 6, "w4a16": 6, "w8a8": 6, "w4a8": 6, "migrat": 7, "jax": 7, "public": 7, "renam": 7, "regist": [7, 8], "init_method": [7, 8], "plugin": 7, "xpu": 7, "neuron": 7, "continu": [7, 9], "xrt_tpu_config": 7, "libtpu": 7, "thousand": 7, "preview": 7, "On": [7, 8], "safe": 7, "broadcast": 7, "broadcast_master_param": 7, "pjrt_backend": 7, "diff": 7, "42": 7, "confirm": 7, "localservic": 7, "51011": 7, "grpc": 7, "torchbench": 7, "2048": 7, "read": 7, "central2": 7, "256": 7, "tpu_process_bound": 7, "tpu_visible_chip": 7, "r1": 7, "preinstal": 7, "docker_imag": 7, "gcr": 7, "authent": 7, "privat": 7, "gcp": 7, "auth": 7, "rm": 7, "privileg": 7, "simpli": 7, "nnode": 7, "num_gpu_devic": 7, "pjrt_distribut": 7, "physic": [7, 8], "number_gpu_vm": 7, "node_rank": 7, "current_node_rank": 7, "nproc_per_nod": 7, "number_local_gpu_devic": 7, "rdzv_endpoint": 7, "internal_ip_address": 7, "port": 7, "multinode_train": 7, "endpoint": 7, "omit": [7, 8], "machine_0": 7, "machine_1": 7, "machine_0_internal_ip_address": 7, "ident": 7, "page": 7, "interchang": 7, "subtl": 7, "importantli": 7, "latenc": 7, "deseri": 7, "gain": 7, "interact": 7, "profil": 7, "plan": 7, "simpler": 7, "xla_dist": 7, "sdk": 7, "reimplement": 7, "enhanc": 7, "substanti": 7, "consist": 7, "servic": 7, "unreli": 7, "inbound": 7, "failur": 7, "impos": 7, "unwant": 7, "permit": 7, "subset": 7, "old": 7, "alter": 7, "consid": 7, "all_gather_object": 7, "new_group": 7, "subgroup": 7, "reliabl": 7, "strongli": 7, "queri": 7, "_all_gath": 7, "int32": 7, "zeros_lik": 7, "get_world_s": 7, "averag": 7, "task": 7, "175": 7, "chart": 7, "breakdown": 7, "tfrt": 7, "legaci": 7, "streamexecutor": 7, "tpu_legaci": 7, "comparison": [7, 8], "discuss": 8, "gspmd": 8, "overview": 8, "illustr": 8, "ml": 8, "proper": 8, "hint": 8, "figur": 8, "strategi": 8, "th": 8, "concept": 8, "librari": 8, "cluster": 8, "interconnect": 8, "almost": 8, "encourag": 8, "fist": 8, "express": 8, "paral": 8, "fsdpv2": 8, "famou": 8, "enjoi": 8, "bring": 8, "tabl": 8, "review": 8, "proceed": 8, "spmd_fully_sharded_data_parallel": 8, "spmdfullyshardeddataparallel": 8, "autowrap": 8, "decoderlay": 8, "functool": 8, "decoder_only_model": 8, "shard_output": 8, "fall": 8, "categori": 8, "0th": 8, "children": 8, "infinit": 8, "fork": 8, "hf": 8, "demonstr": 8, "cover": 8, "proced": 8, "src": 8, "_input_sharding_": 8, "4d": 8, "input_shard": 8, "shardingspec": 8, "input_mesh": 8, "s1": 8, "s2": 8, "s3": 8, "s4": 8, "_after": 8, "_the": 8, "unnecessari": 8, "forth": 8, "techniqu": 8, "decis": 8, "nice": 8, "arrang": 8, "center": 8, "box": 8, "multislic": 8, "accept": 8, "denot": 8, "hardcod": 8, "rfc": 8, "delai": 8, "except": 8, "satisfi": 8, "subclass": 8, "__torch_dispatch__": 8, "invok": [8, 9], "global_tensor": 8, "special": 8, "strictli": 8, "local_shard": 8, "xlashard": 8, "4e8e5511555073ce8b6d1a436bf808c9333dcac6": 8, "xla_sharded_tensor": 8, "l12": 8, "ongo": 8, "distributedtensor": 8, "prototyp": 8, "proof": 8, "distribute_tensor": 8, "devicemesh": 8, "big_tensor": 8, "100000": 8, "my_dtensor": 8, "stai": 8, "tune": 8, "upcom": [8, 9], "dynamo_mark_shard": 8, "placement": 8, "visual": 8, "multi": 8, "visualize_tensor_shard": 8, "visualize_shard": 8, "rich": 8, "2x2": 8, "generated_t": 8, "use_color": 8, "style": 8, "tile": 8, "partial_repl": 8, "envvar": 8, "xla_auto_spmd": 8, "_tensor": 8, "distribute_modul": 8, "auto_polici": 8, "mymodul": 8, "sharded_model": 8, "behvaior": 8, "xla_auto_use_group_shard": 8, "reshard": 8, "xla_auto_spmd_mesh": 8, "unset": 8, "dedic": 8, "planner": 8, "spmdsaveplann": 8, "spmdloadplann": 8, "dist_cp": 8, "distributed_checkpoint": 8, "xc": 8, "storage_writ": 8, "filesystemwrit": 8, "checkpoint_dir": 8, "desir": 8, "storage_read": 8, "filesystemread": 8, "checkpointmanag": 8, "all_step": 8, "save_async": 8, "written": 8, "unblock": 8, "durat": 8, "dispatch": 8, "preemption": 8, "detect": 8, "termin": 8, "provis": 8, "queuedresourc": 8, "autocheckpoint": 8, "chkpt_on_preempt": 8, "fsspec": 8, "filesystem": 8, "gc": 8, "prime_optim": 8, "chkpt_mgr": 8, "tracked_step": 8, "highest": 8, "best_step": 8, "prime": 8, "enumer": 8, "present": 8, "attempt": 8, "unprim": 8, "destruct": 8, "discov": 8, "jit": 9, "unmodifi": 9, "hook": 9, "bridg": 9, "torchfx": 9, "technologi": 9, "fx": 9, "a_xla": 9, "b_xla": 9, "compiled_cod": 9, "eval_model": 9, "xla_resnet18": 9, "eval": 9, "dynamo_resnet18": 9, "no_grad": 9, "resent18": 9, "binari": 9, "analysi": 9, "bench": 9, "59": 9, "resnext50_32x4d": 9, "91": 9, "alexnet": 9, "28": 9, "mobilenet_v2": 9, "18": 9, "mnasnet1_0": 9, "68": 9, "vgg16": 9, "bert_pytorch": 9, "squeezenet1_1": 9, "timm_vision_transform": 9, "52": 9, "geomean": 9, "team": 9, "train_model": 9, "crossentropyloss": 9, "pred": 9, "train_model_main": 9, "dynamo_train_model": 9, "xla_optim": 9, "weight_decai": 9, "extract": 9, "07": 9, "81": 9, "87": 9, "fwd": 9, "bwd": 9, "e2": 9, "hide": 9, "cost": 9, "scenario": 9, "promis": 9, "complex": 9, "tradit": 9, "seen": 9, "expand": 9, "excit": 9, "invest": 9, "upstream": 9, "matur": 9, "stori": 9}, "objects": {"": [[3, 0, 0, "-", "torch_xla"]], "torch_xla": [[3, 1, 1, "", "compile"], [3, 1, 1, "", "device"], [3, 1, 1, "", "device_count"], [3, 1, 1, "", "devices"], [3, 0, 0, "-", "experimental"], [3, 1, 1, "", "manual_seed"], [3, 0, 0, "-", "runtime"], [3, 1, 1, "", "sync"]], "torch_xla.core": [[3, 0, 0, "-", "xla_model"]], "torch_xla.core.xla_model": [[3, 1, 1, "", "add_step_closure"], [3, 1, 1, "", "all_gather"], [3, 1, 1, "", "all_reduce"], [3, 1, 1, "", "all_to_all"], [3, 1, 1, "", "get_memory_info"], [3, 1, 1, "", "get_rng_state"], [3, 1, 1, "", "get_stablehlo"], [3, 1, 1, "", "get_stablehlo_bytecode"], [3, 1, 1, "", "is_master_ordinal"], [3, 1, 1, "", "mesh_reduce"], [3, 1, 1, "", "optimizer_step"], [3, 1, 1, "", "rendezvous"], [3, 1, 1, "", "save"], [3, 1, 1, "", "set_rng_state"], [3, 1, 1, "", "wait_device_ops"], [3, 1, 1, "", "xla_device"], [3, 1, 1, "", "xla_device_hw"]], "torch_xla.debug": [[3, 0, 0, "-", "metrics"]], "torch_xla.debug.metrics": [[3, 1, 1, "", "counter_names"], [3, 1, 1, "", "counter_value"], [3, 1, 1, "", "metric_data"], [3, 1, 1, "", "metric_names"], [3, 1, 1, "", "metrics_report"], [3, 1, 1, "", "short_metrics_report"]], "torch_xla.distributed": [[3, 0, 0, "-", "parallel_loader"], [3, 0, 0, "-", "spmd"], [3, 0, 0, "-", "xla_multiprocessing"]], "torch_xla.distributed.parallel_loader": [[3, 2, 1, "", "MpDeviceLoader"]], "torch_xla.distributed.spmd": [[3, 2, 1, "", "HybridMesh"], [3, 2, 1, "", "Mesh"], [3, 1, 1, "", "clear_sharding"], [3, 1, 1, "", "get_1d_mesh"], [3, 1, 1, "", "get_global_mesh"], [3, 1, 1, "", "mark_sharding"], [3, 1, 1, "", "set_global_mesh"]], "torch_xla.distributed.xla_multiprocessing": [[3, 1, 1, "", "spawn"]], "torch_xla.experimental": [[3, 1, 1, "", "eager_mode"]], "torch_xla.runtime": [[3, 1, 1, "", "addressable_device_count"], [3, 1, 1, "", "device_type"], [3, 1, 1, "", "get_master_ip"], [3, 1, 1, "", "global_device_count"], [3, 1, 1, "", "global_ordinal"], [3, 1, 1, "", "global_runtime_device_count"], [3, 1, 1, "", "initialize_cache"], [3, 1, 1, "", "is_spmd"], [3, 1, 1, "", "local_device_count"], [3, 1, 1, "", "local_ordinal"], [3, 1, 1, "", "local_process_count"], [3, 1, 1, "", "use_spmd"], [3, 1, 1, "", "world_size"]]}, "objtypes": {"0": "py:module", "1": "py:function", "2": "py:class"}, "objnames": {"0": ["py", "module", "Python module"], "1": ["py", "function", "Python function"], "2": ["py", "class", "Python class"]}, "titleterms": {"troubleshoot": 0, "saniti": 0, "check": [0, 2], "pytorch": [0, 2, 3, 4, 8, 9], "xla": [0, 2, 3, 4, 6, 8, 9], "version": 0, "perform": [0, 7], "A": 0, "simpl": [0, 2], "calcul": 0, "run": [0, 2, 3, 8], "resnet": [0, 2, 4], "With": 0, "fake": [0, 4], "data": [0, 4, 8], "debug": [0, 3, 8], "tool": [0, 8], "auto": [0, 8], "metric": 0, "analysi": 0, "compil": [0, 1, 3, 8, 9], "execut": 0, "get": 0, "report": 0, "understand": 0, "The": 0, "clear": 0, "dynamo": 0, "profil": 0, "benchmark": [0, 1, 4], "known": 0, "caveat": 0, "tensor": [0, 3, 5], "quirk": 0, "more": 0, "environ": [0, 2], "variabl": [0, 2], "common": 0, "combin": 0, "reproduc": 0, "ci": 0, "cd": 0, "unit": 0, "test": 0, "failur": 0, "eager": 1, "mode": [1, 8], "api": [1, 3], "background": [1, 4], "basic": 1, "usag": 1, "infer": [1, 9], "train": [1, 4, 7, 9], "how": [2, 4, 6, 8], "gpu": [2, 7], "creat": [2, 3], "instanc": 2, "setup": 2, "docker": [2, 7], "wheel": 2, "some": [2, 5], "model": [2, 3, 6], "mp_imagenet": 2, "exampl": [2, 4, 8], "amp": 2, "automat": 2, "mix": 2, "precis": 2, "develop": 2, "build": 2, "from": [2, 3, 5, 7], "sourc": [2, 5], "support": [2, 6], "document": 3, "doc": 3, "devic": [3, 6], "an": 3, "ar": 3, "singl": [3, 7], "multipl": 3, "multi": [3, 7], "process": 3, "tpu": [3, 4, 7, 8], "pod": [3, 4, 7, 8], "deep": 3, "dive": 3, "lazi": 3, "memori": 3, "layout": 3, "move": 3, "cpu": [3, 7], "save": 3, "load": 3, "cach": 3, "further": [3, 8], "read": [3, 8], "torch_xla": [3, 5], "runtim": [3, 7], "xla_model": 3, "distribut": [3, 7, 8], "spmd": [3, 8], "experiment": [3, 6], "do": 4, "distributeddataparallel": 4, "ddp": 4, "motiv": 4, "us": [4, 5, 6, 8], "resnet50": 4, "mnist": 4, "real": [4, 5], "disclaim": 4, "fulli": [4, 8], "shard": [4, 8], "parallel": [4, 8], "fsdp": [4, 8], "script": 4, "imagenet": 4, "instal": 4, "clone": 4, "repo": 4, "v3": [4, 7], "8": 4, "50": 4, "10": 4, "billion": 4, "paramet": 4, "recompil": 5, "let": 5, "": 5, "first": 5, "start": 5, "fact": 5, "constraint": 5, "1": 5, "input": 5, "dataset": 5, "2": [5, 8], "oper": [5, 6], "output": [5, 8], "bound": 5, "dynam": 5, "shape": 5, "can": 5, "fix": 5, "case": 5, "when": 5, "you": 5, "without": 5, "queri": 5, "its": 5, "dimens": 5, "what": [5, 8], "i": [5, 8], "3": 5, "control": 5, "flow": 5, "conclus": 5, "appendix": 5, "quantiz": 6, "featur": [6, 9], "call": 6, "op": 6, "code": 6, "modul": 6, "swap": 6, "matrix": 6, "multipli": 6, "embed": 6, "pjrt": 7, "tl": 7, "dr": 7, "benefit": 7, "quickstart": 7, "node": 7, "differ": 7, "xrt": 7, "multithread": 7, "v2": 7, "chang": 7, "xm": 7, "rendezv": 7, "torch": [7, 8, 9], "new": 7, "user": 8, "guid": 8, "mesh": 8, "partit": 8, "spec": 8, "via": 8, "gradient": 8, "checkpoint": 8, "huggingfac": 8, "llama": 8, "advanc": 8, "topic": 8, "hybrid": 8, "xlashardedtensor": 8, "dtensor": 8, "integr": [8, 9], "activ": 8, "torchdynamo": 9, "gap": 9, "take": 9, "awai": 9}, "envversion": {"sphinx.domains.c": 2, "sphinx.domains.changeset": 1, "sphinx.domains.citation": 1, "sphinx.domains.cpp": 8, "sphinx.domains.index": 1, "sphinx.domains.javascript": 2, "sphinx.domains.math": 2, "sphinx.domains.python": 3, "sphinx.domains.rst": 2, "sphinx.domains.std": 2, "sphinx.ext.intersphinx": 1, "sphinx.ext.todo": 2, "sphinx.ext.viewcode": 1, "sphinx": 57}, "alltitles": {"Troubleshooting": [[0, "troubleshooting"]], "Sanity Check": [[0, "sanity-check"]], "Check PyTorch/XLA Version": [[0, "check-pytorch-xla-version"]], "Perform A Simple Calculation": [[0, "perform-a-simple-calculation"]], "Run Resnet With Fake Data": [[0, "run-resnet-with-fake-data"]], "Performance Debugging": [[0, "performance-debugging"]], "PyTorch/XLA Debugging Tool": [[0, "pytorch-xla-debugging-tool"]], "Perform A Auto-Metrics Analysis": [[0, "perform-a-auto-metrics-analysis"]], "Compilation & Execution Analysis": [[0, "compilation-execution-analysis"]], "Get A Metrics Report": [[0, "get-a-metrics-report"]], "Understand The Metrics Report": [[0, "understand-the-metrics-report"]], "Clear The Metrics Report": [[0, "clear-the-metrics-report"]], "PyTorch/XLA + Dynamo Debugging Tool": [[0, "pytorch-xla-dynamo-debugging-tool"]], "Performance Profiling": [[0, "performance-profiling"]], "Simple Benchmarking": [[0, "simple-benchmarking"]], "Known Performance Caveats": [[0, "known-performance-caveats"]], "XLA Tensor Quirks": [[0, "xla-tensor-quirks"]], "More Debugging Tools": [[0, "more-debugging-tools"]], "Environment Variables": [[0, "environment-variables"]], "Common Debugging Environment Variables Combinations": [[0, "common-debugging-environment-variables-combinations"]], "Reproducing PyTorch/XLA CI/CD unit test failures.": [[0, "reproducing-pytorch-xla-ci-cd-unit-test-failures"]], "Eager Mode + Compile API": [[1, "eager-mode-compile-api"]], "Background": [[1, "background"]], "Basic Usage": [[1, "basic-usage"]], "Inference": [[1, "inference"], [9, "inference"]], "Training": [[1, "training"], [9, "training"]], "Benchmark": [[1, "benchmark"]], "How to run with PyTorch/XLA:GPU": [[2, "how-to-run-with-pytorch-xla-gpu"]], "Create a GPU instance": [[2, "create-a-gpu-instance"]], "Environment Setup": [[2, "environment-setup"]], "Docker": [[2, "docker"], [7, "docker"]], "Check environment variable": [[2, "check-environment-variable"]], "Wheel": [[2, "wheel"]], "Run some simple models": [[2, "run-some-simple-models"]], "MP_ImageNet Example": [[2, "mp-imagenet-example"]], "ResNet Example": [[2, "resnet-example"]], "AMP (AUTOMATIC MIXED PRECISION)": [[2, "amp-automatic-mixed-precision"]], "Develop PyTorch/XLA on a GPU instance (build PyTorch/XLA from source with GPU support)": [[2, "develop-pytorch-xla-on-a-gpu-instance-build-pytorch-xla-from-source-with-gpu-support"]], "PyTorch/XLA documentation": [[3, "pytorch-xla-documentation"]], "Docs": [[3, null]], "PyTorch on XLA Devices": [[3, "pytorch-on-xla-devices"]], "Creating an XLA Tensor": [[3, "creating-an-xla-tensor"]], "XLA Tensors are PyTorch Tensors": [[3, "xla-tensors-are-pytorch-tensors"]], "Running Models on XLA Devices": [[3, "running-models-on-xla-devices"]], "Running on a Single XLA Device": [[3, "running-on-a-single-xla-device"]], "Running on Multiple XLA Devices with Multi-processing": [[3, "running-on-multiple-xla-devices-with-multi-processing"]], "Running on TPU Pods": [[3, "running-on-tpu-pods"]], "XLA Tensor Deep Dive": [[3, "id3"]], "XLA Tensors are Lazy": [[3, "xla-tensors-are-lazy"]], "Memory Layout": [[3, "memory-layout"]], "Moving XLA Tensors to and from the CPU": [[3, "moving-xla-tensors-to-and-from-the-cpu"]], "Saving and Loading XLA Tensors": [[3, "saving-and-loading-xla-tensors"]], "Compilation Caching": [[3, "compilation-caching"]], "Further Reading": [[3, "further-reading"], [8, "further-reading"]], "PyTorch/XLA API": [[3, "pytorch-xla-api"]], "torch_xla": [[3, "module-torch_xla"]], "runtime": [[3, "module-torch_xla.runtime"]], "xla_model": [[3, "module-torch_xla.core.xla_model"]], "distributed": [[3, "module-torch_xla.distributed.parallel_loader"]], "spmd": [[3, "module-torch_xla.distributed.spmd"]], "experimental": [[3, "module-torch_xla.experimental"]], "debug": [[3, "module-torch_xla.debug.metrics"]], "How to do DistributedDataParallel(DDP)": [[4, "how-to-do-distributeddataparallel-ddp"]], "Background / Motivation": [[4, "background-motivation"]], "How to use DistributedDataParallel": [[4, "how-to-use-distributeddataparallel"]], "Benchmarking": [[4, "benchmarking"]], "Resnet50 with fake data": [[4, "resnet50-with-fake-data"]], "MNIST with fake data": [[4, "mnist-with-fake-data"]], "MNIST with real data": [[4, "mnist-with-real-data"]], "Disclaimer": [[4, "disclaimer"]], "Fully Sharded Data Parallel (FSDP) in PyTorch XLA": [[4, "fully-sharded-data-parallel-fsdp-in-pytorch-xla"]], "Example training scripts on MNIST and ImageNet": [[4, "example-training-scripts-on-mnist-and-imagenet"]], "Installation": [[4, "installation"]], "Clone PyTorch/XLA repo": [[4, "clone-pytorch-xla-repo"]], "Train MNIST on v3-8 TPU": [[4, "train-mnist-on-v3-8-tpu"]], "Train ImageNet with ResNet-50 on v3-8 TPU": [[4, "train-imagenet-with-resnet-50-on-v3-8-tpu"]], "Example training scripts on TPU pod (with 10 billion parameters)": [[4, "example-training-scripts-on-tpu-pod-with-10-billion-parameters"]], "Source of recompilations in torch_xla": [[5, "source-of-recompilations-in-torch-xla"]], "Let\u2019s first start with some facts/constraints:": [[5, "lets-first-start-with-some-facts-constraints"]], "#1. From input dataset.": [[5, "from-input-dataset"]], "#2. From operator output": [[5, "from-operator-output"]], "2.1 Bounded dynamic shape can fix the case when you use the tensor with dynamic shape as a Tensor, without querying its real dimension.": [[5, "bounded-dynamic-shape-can-fix-the-case-when-you-use-the-tensor-with-dynamic-shape-as-a-tensor-without-querying-its-real-dimension"]], "2.2 what if real dimension is queried on a tensor with dynamic shape?": [[5, "what-if-real-dimension-is-queried-on-a-tensor-with-dynamic-shape"]], "#3. From control flow": [[5, "from-control-flow"]], "Conclusion:": [[5, "conclusion"]], "Appendix:": [[5, "appendix"]], "Quantized Operations for XLA device (Experimental feature)": [[6, "quantized-operations-for-xla-device-experimental-feature"]], "How to use:": [[6, "how-to-use"]], "Call XLA quantized op in model code": [[6, "call-xla-quantized-op-in-model-code"]], "Module Swap": [[6, "module-swap"]], "Supported Quantized Operations:": [[6, "supported-quantized-operations"]], "Matrix Multiply": [[6, "matrix-multiply"]], "Embedding": [[6, "embedding"]], "PJRT Runtime": [[7, "pjrt-runtime"]], "TL;DR": [[7, "tl-dr"]], "Benefits": [[7, "benefits"]], "Quickstart": [[7, "quickstart"]], "CPU": [[7, "cpu"]], "TPU": [[7, "tpu"]], "Pods": [[7, "pods"]], "GPU": [[7, "gpu"]], "Single-node GPU training": [[7, "single-node-gpu-training"]], "Multi-node GPU training": [[7, "multi-node-gpu-training"]], "Differences from XRT": [[7, "differences-from-xrt"]], "Multithreading on TPU v2/v3": [[7, "id3"]], "Changes to xm.rendezvous": [[7, "changes-to-xm-rendezvous"]], "PJRT and torch.distributed": [[7, "pjrt-and-torch-distributed"]], "Performance": [[7, "performance"]], "New TPU runtime": [[7, "new-tpu-runtime"]], "PyTorch/XLA SPMD User Guide": [[8, "pytorch-xla-spmd-user-guide"]], "What is PyTorch/XLA SPMD?": [[8, "what-is-pytorch-xla-spmd"]], "How to use PyTorch/XLA SPMD?": [[8, "how-to-use-pytorch-xla-spmd"]], "SPMD Mode": [[8, "spmd-mode"]], "Mesh": [[8, "mesh"]], "Partition Spec": [[8, "partition-spec"]], "Fully Sharded Data Parallel(FSDP) via SPMD": [[8, "fully-sharded-data-parallel-fsdp-via-spmd"]], "Sharding output": [[8, "sharding-output"]], "Gradient checkpointing": [[8, "gradient-checkpointing"]], "HuggingFace Llama 2 Example": [[8, "huggingface-llama-2-example"]], "PyTorch/XLA SPMD advanced topics": [[8, "pytorch-xla-spmd-advanced-topics"]], "Hybrid Mesh": [[8, "hybrid-mesh"]], "Running SPMD on TPU Pod": [[8, "running-spmd-on-tpu-pod"]], "XLAShardedTensor": [[8, "xlashardedtensor"]], "DTensor Integration": [[8, "dtensor-integration"]], "Activation Sharding for torch.compile": [[8, "activation-sharding-for-torch-compile"]], "SPMD Debugging Tool": [[8, "spmd-debugging-tool"]], "Auto-Sharding": [[8, "auto-sharding"]], "Distributed Checkpointing": [[8, "distributed-checkpointing"]], "TorchDynamo(torch.compile) integration in PyTorch XLA": [[9, "torchdynamo-torch-compile-integration-in-pytorch-xla"]], "Integration": [[9, "integration"]], "Feature gaps": [[9, "feature-gaps"]], "Take away": [[9, "take-away"]]}, "indexentries": {"hybridmesh (class in torch_xla.distributed.spmd)": [[3, "torch_xla.distributed.spmd.HybridMesh"]], "mesh (class in torch_xla.distributed.spmd)": [[3, "torch_xla.distributed.spmd.Mesh"]], "mpdeviceloader (class in torch_xla.distributed.parallel_loader)": [[3, "torch_xla.distributed.parallel_loader.MpDeviceLoader"]], "add_step_closure() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.add_step_closure"]], "addressable_device_count() (in module torch_xla.runtime)": [[3, "torch_xla.runtime.addressable_device_count"]], "all_gather() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.all_gather"]], "all_reduce() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.all_reduce"]], "all_to_all() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.all_to_all"]], "clear_sharding() (in module torch_xla.distributed.spmd)": [[3, "torch_xla.distributed.spmd.clear_sharding"]], "compile() (in module torch_xla)": [[3, "torch_xla.compile"]], "counter_names() (in module torch_xla.debug.metrics)": [[3, "torch_xla.debug.metrics.counter_names"]], "counter_value() (in module torch_xla.debug.metrics)": [[3, "torch_xla.debug.metrics.counter_value"]], "device() (in module torch_xla)": [[3, "torch_xla.device"]], "device_count() (in module torch_xla)": [[3, "torch_xla.device_count"]], "device_type() (in module torch_xla.runtime)": [[3, "torch_xla.runtime.device_type"]], "devices() (in module torch_xla)": [[3, "torch_xla.devices"]], "eager_mode() (in module torch_xla.experimental)": [[3, "torch_xla.experimental.eager_mode"]], "get_1d_mesh() (in module torch_xla.distributed.spmd)": [[3, "torch_xla.distributed.spmd.get_1d_mesh"]], "get_global_mesh() (in module torch_xla.distributed.spmd)": [[3, "torch_xla.distributed.spmd.get_global_mesh"]], "get_master_ip() (in module torch_xla.runtime)": [[3, "torch_xla.runtime.get_master_ip"]], "get_memory_info() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.get_memory_info"]], "get_rng_state() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.get_rng_state"]], "get_stablehlo() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.get_stablehlo"]], "get_stablehlo_bytecode() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.get_stablehlo_bytecode"]], "global_device_count() (in module torch_xla.runtime)": [[3, "torch_xla.runtime.global_device_count"]], "global_ordinal() (in module torch_xla.runtime)": [[3, "torch_xla.runtime.global_ordinal"]], "global_runtime_device_count() (in module torch_xla.runtime)": [[3, "torch_xla.runtime.global_runtime_device_count"]], "initialize_cache() (in module torch_xla.runtime)": [[3, "torch_xla.runtime.initialize_cache"]], "is_master_ordinal() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.is_master_ordinal"]], "is_spmd() (in module torch_xla.runtime)": [[3, "torch_xla.runtime.is_spmd"]], "local_device_count() (in module torch_xla.runtime)": [[3, "torch_xla.runtime.local_device_count"]], "local_ordinal() (in module torch_xla.runtime)": [[3, "torch_xla.runtime.local_ordinal"]], "local_process_count() (in module torch_xla.runtime)": [[3, "torch_xla.runtime.local_process_count"]], "manual_seed() (in module torch_xla)": [[3, "torch_xla.manual_seed"]], "mark_sharding() (in module torch_xla.distributed.spmd)": [[3, "torch_xla.distributed.spmd.mark_sharding"]], "mesh_reduce() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.mesh_reduce"]], "metric_data() (in module torch_xla.debug.metrics)": [[3, "torch_xla.debug.metrics.metric_data"]], "metric_names() (in module torch_xla.debug.metrics)": [[3, "torch_xla.debug.metrics.metric_names"]], "metrics_report() (in module torch_xla.debug.metrics)": [[3, "torch_xla.debug.metrics.metrics_report"]], "module": [[3, "module-torch_xla"], [3, "module-torch_xla.core.xla_model"], [3, "module-torch_xla.debug.metrics"], [3, "module-torch_xla.distributed.parallel_loader"], [3, "module-torch_xla.distributed.spmd"], [3, "module-torch_xla.distributed.xla_multiprocessing"], [3, "module-torch_xla.experimental"], [3, "module-torch_xla.runtime"]], "optimizer_step() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.optimizer_step"]], "rendezvous() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.rendezvous"]], "save() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.save"]], "set_global_mesh() (in module torch_xla.distributed.spmd)": [[3, "torch_xla.distributed.spmd.set_global_mesh"]], "set_rng_state() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.set_rng_state"]], "short_metrics_report() (in module torch_xla.debug.metrics)": [[3, "torch_xla.debug.metrics.short_metrics_report"]], "spawn() (in module torch_xla.distributed.xla_multiprocessing)": [[3, "torch_xla.distributed.xla_multiprocessing.spawn"]], "sync() (in module torch_xla)": [[3, "torch_xla.sync"]], "torch_xla": [[3, "module-torch_xla"]], "torch_xla.core.xla_model": [[3, "module-torch_xla.core.xla_model"]], "torch_xla.debug.metrics": [[3, "module-torch_xla.debug.metrics"]], "torch_xla.distributed.parallel_loader": [[3, "module-torch_xla.distributed.parallel_loader"]], "torch_xla.distributed.spmd": [[3, "module-torch_xla.distributed.spmd"]], "torch_xla.distributed.xla_multiprocessing": [[3, "module-torch_xla.distributed.xla_multiprocessing"]], "torch_xla.experimental": [[3, "module-torch_xla.experimental"]], "torch_xla.runtime": [[3, "module-torch_xla.runtime"]], "use_spmd() (in module torch_xla.runtime)": [[3, "torch_xla.runtime.use_spmd"]], "wait_device_ops() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.wait_device_ops"]], "world_size() (in module torch_xla.runtime)": [[3, "torch_xla.runtime.world_size"]], "xla_device() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.xla_device"]], "xla_device_hw() (in module torch_xla.core.xla_model)": [[3, "torch_xla.core.xla_model.xla_device_hw"]]}})